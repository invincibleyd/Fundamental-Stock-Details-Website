<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Mutual Fund Schemes</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="table-styles.css">
    <style>
        /* Style for the search container */
        #search-container {
            display: flex;
            align-items: center;
            position: relative;
            max-width: 400px;
            margin: 20px auto;
        }

        #search-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px 0 0 5px;
            outline: none;
        }

        #search-button {
            padding: 10px 15px;
            border: none;
            border-radius: 0 5px 5px 0;
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }

        #search-button:hover {
            background-color: #0056b3;
        }

        /* Dropdown suggestions styling */
        #suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #fff;
            border: 1px solid #ccc;
            border-top: none;
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        #suggestions li {
            padding: 10px;
            cursor: pointer;
        }

        #suggestions li:hover,
        #suggestions li.highlight {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <div id="search-container">
        <input type="text" id="search-input" placeholder="Search Mutual Fund Schemes..." onkeyup="searchSchemes(event)">
        <button id="search-button" onclick="searchSchemes(event)">Search</button>
        <ul id="suggestions"></ul>
    </div>

    <div id="scheme-details-container">
        <!-- Block for displaying scheme meta information -->
        <div id="scheme-details" class="scheme-details" style="display: none;">
            <!-- Data will be inserted dynamically -->
        </div>

        <!-- Table for displaying scheme data -->
        <div id="scheme-table-container" style="display: none;">
            <table id="scheme-table" class="scheme-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Net Asset Value (NAV)</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data rows will be inserted dynamically -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const suggestionsList = document.getElementById('suggestions');
        const schemeDetailsContainer = document.getElementById('scheme-details');
        const schemeTableContainer = document.getElementById('scheme-table-container');
        const schemeTableBody = document.getElementById('scheme-table').getElementsByTagName('tbody')[0];
        let allSchemes = [];
        let currentIndex = -1; // Tracks the currently selected suggestion

        // Fetch schemes from the API
        fetch('https://api.mfapi.in/mf')
            .then(response => response.json())
            .then(data => {
                allSchemes = data;
            })
            .catch(error => console.error('Error fetching schemes:', error));

        // Search schemes and update suggestions
        function searchSchemes(event) {
            const query = searchInput.value.toLowerCase();
            suggestionsList.innerHTML = ''; // Clear old suggestions

            if (query) {
                const filteredSchemes = allSchemes.filter(item =>
                    item.schemeName.toLowerCase().includes(query)
                );

                filteredSchemes.forEach((scheme, index) => {
                    const li = document.createElement('li');
                    li.textContent = scheme.schemeName;
                    li.onclick = () => {
                        fetchSchemeDetails(scheme.schemeCode);
                        suggestionsList.innerHTML = ''; // Clear suggestions
                    };

                    // Add keyboard navigation functionality
                    li.onmouseenter = () => highlightSuggestion(index);
                    li.onmouseleave = () => unhighlightSuggestion(index);

                    suggestionsList.appendChild(li);
                });
            }

            handleKeyboardNavigation(event);
        }

        // Handle arrow keys and enter key
        function handleKeyboardNavigation(event) {
            const suggestions = suggestionsList.getElementsByTagName('li');

            if (event.key === 'ArrowDown') {
                if (currentIndex < suggestions.length - 1) {
                    currentIndex++;
                    highlightSuggestion(currentIndex);
                }
            } else if (event.key === 'ArrowUp') {
                if (currentIndex > 0) {
                    currentIndex--;
                    highlightSuggestion(currentIndex);
                }
            } else if (event.key === 'Enter' && currentIndex >= 0) {
                suggestions[currentIndex].click();
            }
        }

        // Highlight suggestion by index
        function highlightSuggestion(index) {
            const suggestions = suggestionsList.getElementsByTagName('li');
            Array.from(suggestions).forEach(item => item.classList.remove('highlight'));
            suggestions[index].classList.add('highlight');
        }

        // Unhighlight suggestion
        function unhighlightSuggestion(index) {
            const suggestions = suggestionsList.getElementsByTagName('li');
            suggestions[index].classList.remove('highlight');
        }

        // Fetch and display scheme details
        function fetchSchemeDetails(schemeCode) {
            const apiUrl = `https://api.mfapi.in/mf/${schemeCode}`;

            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    const meta = data.meta;
                    const historicalData = data.data; // Assuming data contains historical NAV info
                    displaySchemeDetails(meta);
                    displaySchemeTable(historicalData);
                })
                .catch(error => console.error('Error fetching scheme details:', error));
        }

        // Display scheme meta details
        function displaySchemeDetails(meta) {
            schemeDetailsContainer.innerHTML = `
                <div><strong>Fund House:</strong> ${meta.fund_house}</div>
                <div><strong>Scheme Type:</strong> ${meta.scheme_type}</div>
                <div><strong>Scheme Category:</strong> ${meta.scheme_category}</div>
                <div><strong>Scheme Code:</strong> ${meta.scheme_code}</div>
                <div><strong>Scheme Name:</strong> ${meta.scheme_name}</div>
                <div><strong>ISIN Growth:</strong> ${meta.isin_growth || 'N/A'}</div>
            `;
            schemeDetailsContainer.style.display = 'block';
        }

        // Display scheme table
        function displaySchemeTable(data) {
            schemeTableBody.innerHTML = ''; // Clear previous rows
            data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${item.date}</td><td>${item.nav}</td>`;
                schemeTableBody.appendChild(row);
            });
            schemeTableContainer.style.display = 'block';
        }
    </script>
</body>
</html>
